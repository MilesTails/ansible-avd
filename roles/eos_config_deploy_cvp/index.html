<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Arista Ansible Team">
    <link rel="shortcut icon" href="../../docs/_media/favicon.ico">
    <title>eos_config_deploy_cvp &mdash; Arista AVD collection</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="../../docs/stylesheets/extra.ivory.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../.." class="site-name"> Arista AVD collection</a>
                </div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../..">Home</a></li>
                    <li class="toctree-l1"><button class="section nav-item">Installation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../docs/installation/requirements/">Requirements</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../docs/installation/setup-environement/">Setup environment</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../docs/installation/setup-galaxy/">Ansible-galaxy installation</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../docs/installation/setup-git/">Git installation</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../docs/installation/development/">Configure development environment</a></li>
</ul></li>
                    <li class="toctree-l1"><a class="nav-item" href="../../docs/getting-started/">Getting Started</a></li>
                    <li class="toctree-l1"><button class="section nav-item">How-To</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../docs/how-to/first-project/">Build your first AVD project</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Roles documentation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../eos_l3ls_evpn/">eos_l3ls_evpn</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../eos_cli_config_gen/">eos_cli_config_gen</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../cvp_configlet_upload/">cvp_configlet_upload</a></li>
    <li class="toctree-l2 current"><a class="nav-item current" href="./">eos_config_deploy_cvp</a>
<ul class="subnav">
<li class="toctree-l3"><a class="nav-item toc" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#role-requirements">Role requirements</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#role-inputs-and-outputs">Role Inputs and Outputs</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#license">License</a></li>
</ul></li>
    <li class="toctree-l2"><a class="nav-item" href="../eos_config_deploy_eapi/">eos_config_deploy_eapi</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../eos_validate_state/">eos_validate_state</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../build_output_folders/">build_output_folders</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Modules documentation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../docs/modules/inventory_to_container.rst/">Module Inventory to containers</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../docs/modules/configlet_build_config.rst/">Module Configlet Build configuration</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">External resources</button>
<ul class="subnav">
    <li class="toctree-l2">
<a class="nav-item" href="https://docs.ansible.com/ansible/latest/user_guide/collections_using.html">Ansible collection user guide</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://docs.ansible.com/ansible/latest/user_guide/index.html">Ansible User guide</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">About</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../docs/contributing/">Contribution Guide</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://galaxy.ansible.com/arista/cvp">Ansible Galaxy page</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://github.com/aristanetworks/ansible-cvp">Arista CloudVision Modules</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://github.com/aristanetworks/netdevops-examples">Arista Automation Examples</a></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
    </div>
    <div class="previous"><a href="../cvp_configlet_upload/">&laquo; Previous</a></div>
    <div class="next"><a href="../eos_config_deploy_eapi/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../.." class="site-name"> Arista AVD collection</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>Roles documentation</li>
</ul>
</nav>
                <div id="content"><h1 id="ansible-role-eos_config_deploy_cvp">Ansible Role: eos_config_deploy_cvp<a class="headerlink" href="#ansible-role-eos_config_deploy_cvp" title="Permanent link">#</a></h1>
<p><strong>Table of Contents:</strong></p>
<ul>
<li><a href="#ansible-role-eos_config_deploy_cvp">Ansible Role: eos_config_deploy_cvp</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#role-requirements">Role requirements</a></li>
<li><a href="#role-inputs-and-outputs">Role Inputs and Outputs</a><ul>
<li><a href="#inputs">Inputs</a></li>
<li><a href="#module-variables">Module variables</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#add-additional-configlets">Add additional configlets</a></li>
<li><a href="#run-module-with-different-tags">Run module with different tags</a></li>
<li><a href="#outputs">Outputs</a></li>
<li><a href="#tasks">Tasks</a></li>
</ul>
</li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p><strong>eos_config_deploy_cvp</strong>, is a role that deploys the configuration to Arista EOS devices via CloudVision Management platform.</p>
<p>The <strong>eos_config_deploy_cvp</strong> role:</p>
<ul>
<li>Designed to configure CloudVision with fabric configlets &amp; topology.</li>
<li>Deploy intended configlets to devices and execute pending tasks.</li>
</ul>
<h2 id="role-requirements">Role requirements<a class="headerlink" href="#role-requirements" title="Permanent link">#</a></h2>
<p>This role requires to install <code>arista.cvp</code> collection to support CloudVision interactions.</p>
<div class="highlight"><pre><span></span><code>$ ansible-galaxy collection install arista.cvp
</code></pre></div>

<blockquote>
<p><strong>NOTE</strong>: When using ansible-cvp modules, the user that is executing the ansible-playbook has to have access to both CVP and the EOS CLI.</p>
</blockquote>
<h2 id="role-inputs-and-outputs">Role Inputs and Outputs<a class="headerlink" href="#role-inputs-and-outputs" title="Permanent link">#</a></h2>
<p>Figure 1 below provides a visualization of the roles inputs, and outputs and tasks in order executed by the role.</p>
<p><img alt="Figure 1: Ansible Role eos_config_deploy_eapi" src="media/role_eos_config_deploy_cvp.gif" /></p>
<ol>
<li>Read inventory file</li>
<li>Build containers topology</li>
<li>Role looks for configuration previously generated by <a href="../eos_cli_config_gen/"><code>arista.avd.eos_cli_config_gen</code></a></li>
<li>List configuration and build configlets list, one per device.</li>
<li>Role looks for additional configlets to attach to either devices or containers.</li>
<li>Build CloudVision configuration using <a href="https://github.com/aristanetworks/ansible-cvp/"><code>arista.cvp</code></a> collection:</li>
<li>Build configlets on CV.</li>
<li>Create containers topology.</li>
<li>Move devices to container.</li>
<li>Bind Configlet to device.</li>
<li>Deploy Fabric configuration by running all pending tasks (optional, if execute_tasks == true).</li>
</ol>
<h3 id="inputs">Inputs<a class="headerlink" href="#inputs" title="Permanent link">#</a></h3>
<p><strong>Inventory configuration:</strong></p>
<p>An entry must be part of the inventory to describe CloudVision server. <code>arista.cvp</code> modules use httpapi approach. Example below provides framework to use in your inventory.</p>
<div class="highlight"><pre><span></span><code><span class="nt">all</span><span class="p">:</span>
  <span class="nt">children</span><span class="p">:</span>
    <span class="nt">cloudvision</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">cv_server01</span><span class="p">:</span>
          <span class="nt">ansible_httpapi_host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.83.28.164</span>
          <span class="nt">ansible_host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.83.28.164</span>
          <span class="nt">ansible_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>
          <span class="nt">ansible_password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible</span>
          <span class="nt">ansible_connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpapi</span>
          <span class="nt">ansible_httpapi_use_ssl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
          <span class="nt">ansible_httpapi_validate_certs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
          <span class="nt">ansible_network_os</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eos</span>
          <span class="nt">ansible_httpapi_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
          <span class="c1"># Configuration to get Virtual Env information</span>
          <span class="nt">ansible_python_interpreter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(which python3)</span>
</code></pre></div>

<h3 id="module-variables">Module variables<a class="headerlink" href="#module-variables" title="Permanent link">#</a></h3>
<ul>
<li><strong><code>container_root</code></strong>: Inventory group name where Fabric devices are located. Default: <code>all</code>.</li>
<li><strong><code>configlets_prefix</code></strong>: Prefix to use for configlet on CV side. Default: <code>{{ fabric_name }}</code>.</li>
<li><strong><code>device_filter</code></strong>: Filter to target a specific set of devices on CV side. Default: <code>AVD-{{ fabric_name }}-</code>.</li>
<li><strong><code>state</code></strong>: <code>present</code> / <code>absent</code>. Support creation or cleanup topology on CV server. Default: <code>present</code>.</li>
<li><strong><code>execute_tasks</code></strong>:  <code>true</code> / <code>false</code>. Support automatically excuting pending tasks. Default: <code>false</code>.</li>
<li><strong><code>cvp_configlets</code></strong>: Structure to add additional configlets to those automatically generated by AVD roles.</li>
</ul>
<h4 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">run CVP provisioning</span>
    <span class="nt">import_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eos_config_deploy_cvp</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">container_root</span><span class="p">:</span> <span class="s">&#39;DC1_FABRIC&#39;</span>
      <span class="nt">configlets_prefix</span><span class="p">:</span> <span class="s">&#39;DC1-AVD&#39;</span>
      <span class="nt">device_filter</span><span class="p">:</span> <span class="s">&#39;DC1&#39;</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
      <span class="nt">execute_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>

<h4 id="add-additional-configlets">Add additional configlets<a class="headerlink" href="#add-additional-configlets" title="Permanent link">#</a></h4>
<p>This structure MUST be part of <code>group_vars</code> targeting <code>container_root</code>. Below is an example applied to <code>eos_l3_evpn</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># group_vars/DC1_FABRIC.yml</span>

<span class="c1"># List of additional CVP configlets to bind to devices and containers</span>
<span class="c1"># Configlets MUST be configured on CVP before running AVD playbooks.</span>
<span class="nt">cv_configlets</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
    <span class="nt">&lt;name of container&gt;</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;First configlet to attach&gt;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;Second configlet to attach&gt;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;...&gt;</span>
  <span class="nt">devices</span><span class="p">:</span>
    <span class="nt">&lt;inventory_hostname&gt;</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;First configlet to attach&gt;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;Second configlet to attach&gt;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;...&gt;</span>
    <span class="nt">&lt;inventory_hostname&gt;</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;First configlet to attach&gt;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;Second configlet to attach&gt;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">&lt;...&gt;</span>
</code></pre></div>

<p>Full example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># group_vars/DC1_FABRIC.yml</span>

<span class="c1"># List of additional CVP configlets to bind to devices and containers</span>
<span class="c1"># Configlets MUST be configured on CVP before running AVD playbooks.</span>
<span class="nt">cv_configlets</span><span class="p">:</span>
  <span class="nt">containers</span><span class="p">:</span>
    <span class="nt">DC1_L3LEAFS</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">GLOBAL-ALIASES</span>
  <span class="nt">devices</span><span class="p">:</span>
    <span class="nt">DC1-L2LEAF2A</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">GLOBAL-ALIASES</span>
    <span class="nt">DC1-L2LEAF2B</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">GLOBAL-ALIASES</span>
</code></pre></div>

<p><em>Notes:</em></p>
<ul>
<li>These configlets <strong>MUST</strong> be created previously on CloudVision server and won&rsquo;t be managed by AVD roles.</li>
<li>Current version <strong>does not support</strong> configlets unbound from container for safety reason. In such case, configlets should be removed from variables and manually unbind from containers on Cloudvision.</li>
</ul>
<h4 id="run-module-with-different-tags">Run module with different tags<a class="headerlink" href="#run-module-with-different-tags" title="Permanent link">#</a></h4>
<p>This module also supports tags to run a subset of ansible tasks:</p>
<ul>
<li><strong><code>build</code></strong>: Generate Arista Validated Design configuration for EOS devices (structure_configs / configs / documentation) and CloudVision inputs.</li>
<li><strong><code>provision</code></strong>: Run <code>build</code> tags + configure Cloudvision with information generated in previous tasks</li>
</ul>
<div class="highlight"><pre><span></span><code>$ ansible-playbook playbook.to.deploy.with.cvp.yml --tags <span class="s2">&quot;provision&quot;</span>
</code></pre></div>

<h3 id="outputs">Outputs<a class="headerlink" href="#outputs" title="Permanent link">#</a></h3>
<ul>
<li>None.</li>
</ul>
<h3 id="tasks">Tasks<a class="headerlink" href="#tasks" title="Permanent link">#</a></h3>
<ol>
<li>Copy generated configuration to CloudVision static configlets.</li>
<li>Create container topology and attach devices to correct container</li>
<li>Bind configlet to devices.</li>
<li>Apply generated tasks to deploy configuration to devices.</li>
</ol>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">#</a></h2>
<p>Requirements are located here: <a href="../..#Requirements">avd-requirements</a></p>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">#</a></h2>
<p>Project is published under <a href="../../LICENSE">Apache 2.0 License</a></p></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../cvp_configlet_upload/" title="cvp_configlet_upload"><span>Previous</span></a></div>
        <div class="next"><a href="../eos_config_deploy_eapi/" title="eos_config_deploy_eapi"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
    <script src="../../search/main.js"></script>
</body>

</html>