<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Arista Ansible Team">
    <link rel="shortcut icon" href="../../_media/favicon.ico">
    <title>Configure development environment &mdash; Arista AVD collection</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="../../stylesheets/extra.ivory.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../.." class="site-name"> Arista AVD collection</a>
                </div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../..">Home</a></li>
                    <li class="toctree-l1"><button class="section nav-item">Installation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../requirements/">Requirements</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../setup-environement/">Setup environment</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../setup-galaxy/">Ansible-galaxy installation</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../setup-git/">Git installation</a></li>
    <li class="toctree-l2 current"><a class="nav-item current" href="./">Configure development environment</a>
<ul class="subnav">
<li class="toctree-l3"><a class="nav-item toc" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#getting-started-script">Getting started Script</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#build-local-environment">Build local environment</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#development-test-tools">Development &amp; test tools</a></li>
</ul></li>
</ul></li>
                    <li class="toctree-l1"><a class="nav-item" href="../../getting-started/">Getting Started</a></li>
                    <li class="toctree-l1"><button class="section nav-item">How-To</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../how-to/first-project/">Build your first AVD project</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Roles documentation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_l3ls_evpn/">eos_l3ls_evpn</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_cli_config_gen/">eos_cli_config_gen</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/cvp_configlet_upload/">cvp_configlet_upload</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_config_deploy_cvp/">eos_config_deploy_cvp</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_config_deploy_eapi/">eos_config_deploy_eapi</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_validate_state/">eos_validate_state</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/build_output_folders/">build_output_folders</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Modules documentation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../modules/inventory_to_container.rst/">Module Inventory to containers</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../modules/configlet_build_config.rst/">Module Configlet Build configuration</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">External resources</button>
<ul class="subnav">
    <li class="toctree-l2">
<a class="nav-item" href="https://docs.ansible.com/ansible/latest/user_guide/collections_using.html">Ansible collection user guide</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://docs.ansible.com/ansible/latest/user_guide/index.html">Ansible User guide</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">About</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../contributing/">Contribution Guide</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://galaxy.ansible.com/arista/cvp">Ansible Galaxy page</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://github.com/aristanetworks/ansible-cvp">Arista CloudVision Modules</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://github.com/aristanetworks/netdevops-examples">Arista Automation Examples</a></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
    </div>
    <div class="previous"><a href="../setup-git/">&laquo; Previous</a></div>
    <div class="next"><a href="../../getting-started/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../.." class="site-name"> Arista AVD collection</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>Installation</li>
</ul>
</nav>
                <div id="content"><h1 id="development-process">Development Process<a class="headerlink" href="#development-process" title="Permanent link">#</a></h1>
<ul>
<li><a href="#development-process">Development Process</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#getting-started-script">Getting started Script</a><ul>
<li><a href="#step-by-step-installation-process">Step by step installation process</a></li>
<li><a href="#one-liner-installation">One liner installation</a></li>
</ul>
</li>
<li><a href="#build-local-environment">Build local environment</a><ul>
<li><a href="#docker-container-for-ansible-testing-and-development">Docker Container for Ansible Testing and Development</a></li>
<li><a href="#development-containers">Development containers</a></li>
<li><a href="#container-commands">Container commands</a></li>
<li><a href="#python-virtual-environment">Python Virtual Environment</a></li>
<li><a href="#install-python3-virtual-environment">Install Python3 Virtual Environment</a></li>
</ul>
</li>
<li><a href="#development--test-tools">Development &amp; test tools</a><ul>
<li><a href="#pre-commit-hook">Pre-commit hook</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#run-pre-commit-manually">Run pre-commit manually</a></li>
<li><a href="#configure-git-hook">Configure git hook</a></li>
</ul>
</li>
</ul>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p>Two methods can be used get Ansible up and running quickly with all the requirements to leverage ansible-avd.
A Python Virtual Environment or Docker container.</p>
<p>The best way to use the development files, is to copy them to the root directory where you have your repositories cloned.
For example, see the file/folder structure below.</p>
<div class="highlight"><pre><span></span><code>├── git_projects
│   ├── ansible-avd
│   ├── ansible-cvp
│   ├── ansible-avd-cloudvision-demo
│   ├── &lt;your-own-test-folder&gt;
│   ├── Makefile
...
</code></pre></div>

<h2 id="getting-started-script">Getting started Script<a class="headerlink" href="#getting-started-script" title="Permanent link">#</a></h2>
<h3 id="step-by-step-installation-process">Step by step installation process<a class="headerlink" href="#step-by-step-installation-process" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>mkdir git_projects
<span class="nb">cd</span> git_projects
git clone https://github.com/aristanetworks/ansible-avd.git
git clone https://github.com/aristanetworks/ansible-cvp.git
git clone https://github.com/arista-netdevops-community/ansible-avd-cloudvision-demo.git
cp ansible-avd/development/Makefile ./
make run
</code></pre></div>

<h3 id="one-liner-installation">One liner installation<a class="headerlink" href="#one-liner-installation" title="Permanent link">#</a></h3>
<p>One liner script to setup a development environment. it does following actions:</p>
<ul>
<li>Create local folder for development</li>
<li>Instantiate a local git repository (no remote)</li>
<li>Clone AVD and CVP collections</li>
<li>Deploy Makefile</li>
</ul>
<div class="highlight"><pre><span></span><code>$ sh -c <span class="s2">&quot;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/aristanetworks/ansible-avd/devel/development/install.sh<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>

<h2 id="build-local-environment">Build local environment<a class="headerlink" href="#build-local-environment" title="Permanent link">#</a></h2>
<h3 id="docker-container-for-ansible-testing-and-development">Docker Container for Ansible Testing and Development<a class="headerlink" href="#docker-container-for-ansible-testing-and-development" title="Permanent link">#</a></h3>
<p>The docker container approach for development can be used to ensure that everybody is using the same development environment while still being flexible enough to use the repo you are making changes in. You can inspect the Dockerfile to see what packages have been installed.
The container will mount the current working directory, so you can work with your local files.</p>
<p>The ansible version is passed in with the docker build command using <strong><em>ANSIBLE</em></strong> variable.  If the <strong><em>ANSIBLE</em></strong> variable is not used the Dockerfile will by default set the ansible version to 2.9.2</p>
<p>Before you can use a container, you must install <a href="https://www.docker.com/products/docker-desktop"><strong>Docker CE</strong></a> and <a href="https://docs.docker.com/compose/"><strong>docker-compose</strong></a> on your workstation.</p>
<h4 id="development-containers">Development containers<a class="headerlink" href="#development-containers" title="Permanent link">#</a></h4>
<ul>
<li><a href="https://hub.docker.com/repository/docker/avdteam/base">Ansible shell</a>: provide a built-in container with all AVD and CVP requirements already installed.</li>
<li><a href="https://github.com/titom73/docker-mkdocs">MKDOCS</a> for documentation update: Run MKDOCS in a container and expose port <code>8000</code> to test and validate markdown rendering for AVD site.</li>
</ul>
<h4 id="container-commands">Container commands<a class="headerlink" href="#container-commands" title="Permanent link">#</a></h4>
<p>In this folder you have a <a href="./Makefile"><code>Makefile</code></a> providing a list of commands to start a development environment:</p>
<ul>
<li><code>run</code>: Start a shell within a container and local folder mounted in <code>/projects</code></li>
<li><code>dev-start</code>: Start a stack of containers based on docker-compose: 1 container for ansible playbooks and 1 container for mkdocs</li>
<li><code>dev-stop</code>: Stop compose stack and remove containers.</li>
<li><code>dev-run</code>: Connect to ansible container to run your test playbooks.</li>
<li><code>dev-reload</code>: Run stop and start.</li>
</ul>
<p>If you want to test a specific ansible version, you can refer to this <a href="https://github.com/arista-netdevops-community/docker-avd-base/blob/master/USAGE.md">dedicated page</a> to start your own docker image. You can also use following make command: <code>make ANSIBLE_VERSION=2.9.3 run</code></p>
<p>Since docker image is now automatically published on <a href="https://hub.docker.com/repository/docker/avdteam/base"><strong>docker-hub</strong></a>, a dedicated repository is available on <a href="https://github.com/arista-netdevops-community/docker-avd-base"><strong>Arista Netdevops Community</strong></a>.</p>
<h3 id="python-virtual-environment">Python Virtual Environment<a class="headerlink" href="#python-virtual-environment" title="Permanent link">#</a></h3>
<h4 id="install-python3-virtual-environment">Install Python3 Virtual Environment<a class="headerlink" href="#install-python3-virtual-environment" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># install virtualenv via pip3</span>
$ sudo pip3 install virtualenv
...
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Configure Python virtual environment</span>
$ virtualenv -p python3 .venv
$ <span class="nb">source</span> .venv/bin/activate

<span class="c1"># Install Python requirements</span>
$ pip install -r requirements.txt
</code></pre></div>

<h2 id="development-test-tools">Development &amp; test tools<a class="headerlink" href="#development-test-tools" title="Permanent link">#</a></h2>
<h3 id="pre-commit-hook">Pre-commit hook<a class="headerlink" href="#pre-commit-hook" title="Permanent link">#</a></h3>
<p><a href="../.pre-commit-config.yaml"><code>pre-commit</code></a> can run standard hooks on every commit to automatically point out issues in code such as missing semicolons, trailing whitespace, and debug statements. By pointing these issues out before code review, this allows a code reviewer to focus on the architecture of a change while not wasting time with trivial style nitpicks.</p>
<p>Repository implements following hooks:</p>
<ul>
<li><code>trailing-whitespace</code>: Fix trailing whitespace. if found, commit is stopped and you must run commit process again.</li>
<li><code>end-of-file-fixer</code>: Like <code>trailing-whitespace</code>, this hook fix wrong end of file and stop your commit.</li>
<li><code>check-yaml</code>: Check all YAML files ares valid</li>
<li><code>check-added-large-files</code>: Check if there is no large file included in repository</li>
<li><code>check-merge-conflict</code>: Validate there is no <code>MERGE</code> syntax related to a invalid merge process.</li>
<li><code>pylint</code>: Run python linting with settings defined in <a href="../pylintrc"><code>pylintrc</code></a></li>
<li><code>yamllint</code>: Validate all YAML files using configuration from <a href="../.github/yamllintrc"><code>yamllintrc</code></a></li>
<li><code>ansible-lint</code>: Validate yaml files are valid against ansible rules.</li>
</ul>
<h4 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">#</a></h4>
<p><code>pre-commit</code> is part of <a href="./requirements-dev.txt"><strong>developement requirememnts</strong></a>. To install, run <code>pip command</code>:</p>
<div class="highlight"><pre><span></span><code>$ pip install -r requirements-dev.txt
...
</code></pre></div>

<h4 id="run-pre-commit-manually">Run pre-commit manually<a class="headerlink" href="#run-pre-commit-manually" title="Permanent link">#</a></h4>
<p>To run <code>pre-commit</code> manually before your commit, use this command:</p>
<div class="highlight"><pre><span></span><code>pre-commit run
<span class="o">[</span>WARNING<span class="o">]</span> Unstaged files detected.

<span class="o">[</span>INFO<span class="o">]</span> Stashing unstaged files to /Users/xxx/.cache/pre-commit/patch1590742434.

Trim Trailing Whitespace.............................<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Fix End of Files.....................................<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Check Yaml...........................................<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Check <span class="k">for</span> added large files..........................<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Check <span class="k">for</span> merge conflicts............................<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Check <span class="k">for</span> Linting error on Python files..............<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Check <span class="k">for</span> Linting error on YAML files................<span class="o">(</span>no files to check<span class="o">)</span>Skipped
Check <span class="k">for</span> ansible-lint errors............................................Passed

<span class="o">[</span>INFO<span class="o">]</span> Restored changes from /Users/xxx/.cache/pre-commit/patch1590742434.
</code></pre></div>

<p>Command will automatically detect changed files using git status and run tests according their type.</p>
<h3 id="configure-git-hook">Configure git hook<a class="headerlink" href="#configure-git-hook" title="Permanent link">#</a></h3>
<p>To automatically run tests when running a commit, configure your repository whit command:</p>
<div class="highlight"><pre><span></span><code>$ pre-commit install
pre-commit installed at .git/hooks/pre-commit
</code></pre></div>

<p>To remove installation, use <code>uninstall</code> option.</p></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../setup-git/" title="Git installation"><span>Previous</span></a></div>
        <div class="next"><a href="../../getting-started/" title="Getting Started"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js"></script>
    <script src="../../../search/main.js"></script>
</body>

</html>