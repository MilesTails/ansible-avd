<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Arista Ansible Team">
    <link rel="shortcut icon" href="../../_media/favicon.ico">
    <title>Setup environment &mdash; Arista AVD collection</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="../../stylesheets/extra.ivory.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../.." class="site-name"> Arista AVD collection</a>
                </div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../..">Home</a></li>
                    <li class="toctree-l1"><button class="section nav-item">Installation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../requirements/">Requirements</a></li>
    <li class="toctree-l2 current"><a class="nav-item current" href="./">Setup environment</a>
<ul class="subnav">
<li class="toctree-l3"><a class="nav-item toc" href="#ansible-runner-requirements">Ansible runner requirements</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#create-local-folder-structure">Create local folder structure</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#use-docker-as-avd-shell">Use docker as AVD shell</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#using-python-3-virtual-environment-feature">Using Python 3 Virtual Environment feature</a></li>
</ul></li>
    <li class="toctree-l2"><a class="nav-item" href="../setup-galaxy/">Ansible-galaxy installation</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../setup-git/">Git installation</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../development/">Configure development environment</a></li>
</ul></li>
                    <li class="toctree-l1"><a class="nav-item" href="../../getting-started/">Getting Started</a></li>
                    <li class="toctree-l1"><button class="section nav-item">How-To</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../how-to/first-project/">Build your first AVD project</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Roles documentation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_l3ls_evpn/">eos_l3ls_evpn</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_cli_config_gen/">eos_cli_config_gen</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/cvp_configlet_upload/">cvp_configlet_upload</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_config_deploy_cvp/">eos_config_deploy_cvp</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_config_deploy_eapi/">eos_config_deploy_eapi</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/eos_validate_state/">eos_validate_state</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../roles/build_output_folders/">build_output_folders</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Modules documentation</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../modules/inventory_to_container.rst/">Module Inventory to containers</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../modules/configlet_build_config.rst/">Module Configlet Build configuration</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">External resources</button>
<ul class="subnav">
    <li class="toctree-l2">
<a class="nav-item" href="https://docs.ansible.com/ansible/latest/user_guide/collections_using.html">Ansible collection user guide</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://docs.ansible.com/ansible/latest/user_guide/index.html">Ansible User guide</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">About</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../contributing/">Contribution Guide</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://galaxy.ansible.com/arista/cvp">Ansible Galaxy page</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://github.com/aristanetworks/ansible-cvp">Arista CloudVision Modules</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="https://github.com/aristanetworks/netdevops-examples">Arista Automation Examples</a></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
    </div>
    <div class="previous"><a href="../requirements/">&laquo; Previous</a></div>
    <div class="next"><a href="../setup-galaxy/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../.." class="site-name"> Arista AVD collection</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>Installation</li>
</ul>
</nav>
                <div id="content"><h1 id="setup-ansible-avd-environment">Setup Ansible AVD environment<a class="headerlink" href="#setup-ansible-avd-environment" title="Permanent link">#</a></h1>
<p>Two methods can be used get Ansible up and running quickly with all the requirements to leverage <strong>ansible-avd</strong>:
A Python Virtual Environment or <a href="https://hub.docker.com/repository/docker/avdteam/base">Docker container</a>.</p>
<p>In both scenario, this document will leverage git approach to create a local environment with collections installed in their respective folders and additional folders for all your content. It means, all examples will be based on the following folder structure:</p>
<div class="highlight"><pre><span></span><code>├── git_projects
│   ├── ansible-avd
│   ├── ansible-cvp
│   ├── ansible-avd-cloudvision-demo
│   ├── Makefile
</code></pre></div>

<h2 id="ansible-runner-requirements">Ansible runner requirements<a class="headerlink" href="#ansible-runner-requirements" title="Permanent link">#</a></h2>
<p>As described in <a href="../requirements/">requirement page</a>, your runner should run Python 3.6.8 or Docker engine with <a href="https://docs.docker.com/compose/install/"><code>docker-compose</code></a>.</p>
<h2 id="create-local-folder-structure">Create local folder structure<a class="headerlink" href="#create-local-folder-structure" title="Permanent link">#</a></h2>
<p>To build local folder structure you manually run all the following commands to git clone <a href="https://github.com/aristanetworks/ansible-avd">ansible-avd</a>, <a href="https://github.com/aristanetworks/ansible-cvp">ansible-cvp collection</a> and a <a href="https://github.com/arista-netdevops-community/ansible-avd-cloudvision-demo">repository with demo content</a></p>
<p>In addition to this 3 <code>git clone</code>, you can also deployed a <a href="https://github.com/aristanetworks/ansible-avd/blob/devel/development/Makefile">Makefile</a> built to provide some shortcut we will discuss in a second stage.</p>
<div class="highlight"><pre><span></span><code>$ mkdir git_projects

$ <span class="nb">cd</span> git_projects

$ git clone https://github.com/aristanetworks/ansible-avd.git
$ git clone https://github.com/aristanetworks/ansible-cvp.git
$ git clone https://github.com/arista-netdevops-community/ansible-avd-cloudvision-demo.git

<span class="c1"># Copy Makefile at the root position</span>
$ cp ansible-avd/development/Makefile ./
$ make run
</code></pre></div>

<p>Or you can use a one-liner script available in ansible-avd repository to create this structure for you. This script does following actions:</p>
<ul>
<li>Create local folder for development</li>
<li>Instantiate a local git repository (no remote)</li>
<li>Clone AVD and CVP collections</li>
<li>Deploy Makefile</li>
</ul>
<div class="highlight"><pre><span></span><code>$ sh -c <span class="s2">&quot;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/aristanetworks/ansible-avd/devel/development/install.sh<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>

<p>Because we are cloning ansible collection using git, it is recommended to read documentation about <a href="../setup-git/#update-your-ansiblecfg">how to setup ansible to use collection based on git clone</a>.</p>
<h2 id="use-docker-as-avd-shell">Use docker as AVD shell<a class="headerlink" href="#use-docker-as-avd-shell" title="Permanent link">#</a></h2>
<p>In this approach Docker container will be leveraged to provides all the AVD requirements and playbooks and collection will be shared from your localhost to the container.</p>
<p>This approach make the run process easier as all libraries are pre-configured in container and you can continue to use your preferred text editor to edit and build your content.</p>
<p>Considering you have deployed <a href="https://github.com/aristanetworks/ansible-avd/blob/devel/development/Makefile">Makefile</a> described in previous section, all the outputs will provide native docker command and the Make command.</p>
<h3 id="run-avd-shell">Run AVD shell<a class="headerlink" href="#run-avd-shell" title="Permanent link">#</a></h3>
<p>We are going to start a <a href="https://hub.docker.com/repository/docker/avdteam/base">new container</a> running ansible with all the python requirements and mount local folder under <code>/projects</code>. if image is missing, docker will pull out image for you automatically.</p>
<div class="highlight"><pre><span></span><code>$ docker run --rm -it -v <span class="k">$(</span>PWD<span class="k">)</span>/:/projects avdteam/base:3.6
Unable to find image <span class="s1">&#39;avdteam/base:3.6&#39;</span> locally
<span class="m">3</span>.6: Pulling from avdteam/base
bf5952930446: Already exists
385bb58d08e6: Already exists
f59c6df69726: Already exists
cc14d0cfa632: Already exists
f4eba3bd5be8: Already exists
55c6a5feb373: Already exists
83464a988ea4: Pull <span class="nb">complete</span>
9b675b85887d: Pull <span class="nb">complete</span>
9cce9aa068f4: Pull <span class="nb">complete</span>
a49dbba0fea8: Pull <span class="nb">complete</span>
793f98fe2265: Pull <span class="nb">complete</span>
Digest: sha256:ead3ef030caa6caeafd6ddbfd31ce935da26b66914096c9543d9a44cca993dfd
Status: Downloaded newer image <span class="k">for</span> avdteam/base:3.6
Agent pid <span class="m">45</span>
➜  /projects
</code></pre></div>

<p>You can use a Make command to run exact same set of actions:</p>
<div class="highlight"><pre><span></span><code>$ make run
Unable to find image <span class="s1">&#39;avdteam/base:3.6&#39;</span> locally
<span class="m">3</span>.6: Pulling from avdteam/base
bf5952930446: Already exists
385bb58d08e6: Already exists
f59c6df69726: Already exists
cc14d0cfa632: Already exists
f4eba3bd5be8: Already exists
55c6a5feb373: Already exists
83464a988ea4: Pull <span class="nb">complete</span>
9b675b85887d: Pull <span class="nb">complete</span>
9cce9aa068f4: Pull <span class="nb">complete</span>
a49dbba0fea8: Pull <span class="nb">complete</span>
793f98fe2265: Pull <span class="nb">complete</span>
Digest: sha256:ead3ef030caa6caeafd6ddbfd31ce935da26b66914096c9543d9a44cca993dfd
Status: Downloaded newer image <span class="k">for</span> avdteam/base:3.6
Agent pid <span class="m">45</span>
➜  /projects
</code></pre></div>

<p>Then you can move to your content folder as structure remains the same:</p>
<div class="highlight"><pre><span></span><code>➜  /projects ls -l
drwxr-xr-x <span class="m">24</span> root root  <span class="m">768</span> Sep  <span class="m">4</span> <span class="m">15</span>:47 ansible-avd
drwxr-xr-x <span class="m">24</span> root root  <span class="m">768</span> Sep  <span class="m">4</span> <span class="m">15</span>:47 ansible-cvp
drwxr-xr-x <span class="m">24</span> root root  <span class="m">768</span> Sep  <span class="m">4</span> <span class="m">15</span>:47 ansible-avd-cloudvision-demo
drwxr-xr-x <span class="m">24</span> root root  <span class="m">768</span> Sep  <span class="m">4</span> <span class="m">15</span>:47 Makefile
</code></pre></div>

<p>You can validate everything is setup correctly:</p>
<div class="highlight"><pre><span></span><code>➜  /projects python --version
Python <span class="m">3</span>.6.12

➜  /projects ansible --version
ansible <span class="m">2</span>.9.6
  config <span class="nv">file</span> <span class="o">=</span> None
  configured module search <span class="nv">path</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;/root/.ansible/plugins/modules&#39;</span>, <span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
  ansible python module <span class="nv">location</span> <span class="o">=</span> /root/.local/lib/python3.6/site-packages/ansible
  executable <span class="nv">location</span> <span class="o">=</span> /root/.local/bin/ansible
  python <span class="nv">version</span> <span class="o">=</span> <span class="m">3</span>.6.12 <span class="o">(</span>default, Aug <span class="m">18</span> <span class="m">2020</span>, <span class="m">04</span>:28:43<span class="o">)</span> <span class="o">[</span>GCC <span class="m">8</span>.3.0<span class="o">]</span>
</code></pre></div>

<p>To exit container, just use <code>exit</code></p>
<div class="highlight"><pre><span></span><code>➜  /projects <span class="nb">exit</span>
$
</code></pre></div>

<h3 id="get-latest-image-of-avd-container">Get latest image of AVD container<a class="headerlink" href="#get-latest-image-of-avd-container" title="Permanent link">#</a></h3>
<p>Time to time, AVD container is updated to reflect some changes in either python requirements or ansible version. Because your docker engine won&rsquo;t automatically get latest version, it might be important to update manually this container:</p>
<div class="highlight"><pre><span></span><code>$ docker pull avdteam/base:3.6
latest: Pulling from avdteam/base
8a29a15cefae: Already exists
95df01e08bce: Downloading <span class="o">[==============================================</span>&gt;    <span class="o">]</span>  <span class="m">33</span>.55MB/36.35MB
512a8a4d71f7: Downloading <span class="o">[=========================================</span>&gt;         <span class="o">]</span>   <span class="m">45</span>.1MB/53.85MB
209c1657264b: Download <span class="nb">complete</span>
bd6eece0221e: Downloading <span class="o">[===================</span>&gt;                               <span class="o">]</span>  <span class="m">52</span>.04MB/132.1MB
036c486feecb: Waiting
</code></pre></div>

<p>Your environment is now ready and you can start to build your own project leveraging ansible-avd and ansible-cvp collections.</p>
<h2 id="using-python-3-virtual-environment-feature">Using Python 3 Virtual Environment feature<a class="headerlink" href="#using-python-3-virtual-environment-feature" title="Permanent link">#</a></h2>
<p>This section describes how to configure python to run ansible and AVD.</p>
<p>As a requirement, we consider python3 as default python interpreter and pip3 as package manager for python3. Some differences can be spotted depending on your own operating system and how they package python.</p>
<p><strong>Disclaimer</strong>: Not preferred method. if you are not an experienced user, please use docker approach.</p>
<p>In a shell, install <code>virtualenv</code> package:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># install virtualenv via pip3</span>
$ sudo pip3 install virtualenv
</code></pre></div>

<p>Create a dedicated virtual-environment where AVD will installed all required Python pakages:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">pwd</span>
/home/user/git_projects

<span class="c1"># Configure Python virtual environment</span>
$ virtualenv -p python3 .venv
$ <span class="nb">source</span> .venv/bin/activate

<span class="c1"># Install Python requirements</span>
$ pip3 install -r ansible-avd/development/requirements.txt
...
</code></pre></div></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../requirements/" title="Requirements"><span>Previous</span></a></div>
        <div class="next"><a href="../setup-galaxy/" title="Ansible-galaxy installation"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js"></script>
    <script src="../../../search/main.js"></script>
</body>

</html>